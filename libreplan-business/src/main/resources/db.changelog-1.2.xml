<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
	<changeSet author="smontes" id="initial-database-creation-customer-comunication">
        <createTable tableName="customer_comunication">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="customer_comunication_pkey"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="deadline" type="DATETIME"/>
            <column name="comunication_type" type="INTEGER"/>
            <column name="comunication_date" type="DATETIME"/>
            <column name="reviewed" type="BOOLEAN"/>
            <column name="order_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="smontes" id="initial-database-creation-subcontractor-comunication">
        <createTable tableName="subcontractor_comunication">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="subcontractor_comunication_pkey"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="comunication_type" type="INTEGER"/>
            <column name="comunication_date" type="DATETIME"/>
            <column name="reviewed" type="BOOLEAN"/>
            <column name="subcontracted_task_data" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="smontes" id="initial-database-creation-subcontractor-comunication-value">
        <createTable tableName="subcontrator_comunication_values">
            <column name="subcontractor_comunication_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="date" type="DATETIME"/>
            <column name="progress" type="DECIMAL(19,2)"/>
            <column name="idx" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

    </changeSet>
      <changeSet id="rename-table-customer_comunication-to-customer_communication" author="smontes">
        <comment>Rename table customer_comunication to customer_communication</comment>
        <renameTable oldTableName="customer_comunication" newTableName="customer_communication" />
    </changeSet>

    <changeSet id="rename-column-comunication_type-to-communication_type" author="smontes">
        <comment>Rename column comunication_type to communication_type</comment>
        <renameColumn tableName="customer_communication" oldColumnName="comunication_type"
        newColumnName="communication_type"/>
    </changeSet>

    <changeSet id="rename-column-comunication_date-to-communication_date" author="smontes">
        <comment>Rename column comunication_date to communication_date</comment>
        <renameColumn tableName="customer_communication" oldColumnName="comunication_date"
        newColumnName="communication_date"/>
    </changeSet>

    <changeSet id="rename-table-subcontractor_comunication" author="smontes">
        <comment>Rename table subcontractor_comunication to subcontractor_communication</comment>
        <renameTable oldTableName="subcontractor_comunication" newTableName="subcontractor_communication" />
    </changeSet>

    <changeSet id="rename-column-comunication_type-on-subcontractor-communication" author="smontes">
        <comment>Rename column comunication_type to communication_type</comment>
        <renameColumn tableName="subcontractor_communication" oldColumnName="comunication_type"
        newColumnName="communication_type"/>
    </changeSet>

    <changeSet id="rename-column-comunication_date-on-subcontractor-communication" author="smontes">
        <comment>Rename column comunication_date to communication_date</comment>
        <renameColumn tableName="subcontractor_communication" oldColumnName="comunication_date"
        newColumnName="communication_date"/>
    </changeSet>

    <changeSet id="rename-table-subcontractor_comunication_values" author="smontes">
        <comment>Rename table subcontractor_comunication_values to subcontractor_communication_values</comment>
        <renameTable oldTableName="subcontrator_comunication_values" newTableName="subcontractor_communication_values" />
    </changeSet>

    <changeSet id="rename-column-subcontractor_comunication_id" author="smontes">
        <comment>Rename column subcontractor_comunication_id</comment>
        <renameColumn tableName="subcontractor_communication_values" oldColumnName="subcontractor_comunication_id"
        newColumnName="subcontractor_communication_id"/>
    </changeSet>

	<changeSet author="smontes" id="creation-deadline-communication">
        <createTable tableName="deadline_communication">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="deadline_comunication_pkey"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="save_date" type="DATETIME"/>
            <column name="deliver_date" type="DATETIME"/>
        </createTable>
    </changeSet>

    <changeSet id="add-delivering-date-column-to-order-entity" author="smontes">
        <comment>Add new delivering date column to order</comment>
        <addColumn tableName="deadline_communication">
            <column name="order_id" type="BIGINT"/>
        </addColumn>
    </changeSet>

	<changeSet author="smontes" id="creation-subcontractor-deliver-date">
        <createTable tableName="subcontractor_deliver_date">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="subcontrator_deliver_date_pkey"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="save_date" type="DATETIME"/>
            <column name="subcontractor_deliver_date" type="DATETIME"/>
            <column name="communication_date" type="DATETIME" />
        </createTable>
    </changeSet>

	<changeSet author="smontes" id="add-subcontracted-task-data">
		<comment>Add the column subcontracted_task_id to maintain the relation</comment>
		<addColumn tableName="subcontractor_deliver_date">
			<column name="subcontracted_task_data_id" type="BIGINT"/>
		</addColumn>
	</changeSet>

    <changeSet id="add-task_end_date_effort_duration-to-consolidated_value" author="mrego">
        <comment>
            taskEndDate attribute in class ConsolidatedValue has been changed to IntraDayDate.
            It is needed to add some columns to store EffortDuration in ConsolidatedValue.
        </comment>
        <addColumn tableName="consolidated_value">
            <column name="task_end_date_effort_duration" type="INTEGER" />
        </addColumn>
        <addDefaultValue tableName="consolidated_value"
            columnName="task_end_date_effort_duration"
            defaultValueNumeric="0" />
    </changeSet>

    <changeSet id="change-sum_of_hours_allocated-to-sum_of_assigned_effort" author="jaragunde">
        <comment>Changing sum_of_hours_allocated to sum_of_assigned_effort</comment>
        <renameColumn tableName="task_element"
            oldColumnName="sum_of_hours_allocated"
            newColumnName="sum_of_assigned_effort"
            columnDataType="INTEGER" />
    </changeSet>
    <changeSet id="update-effort-values-in-sum_charged_effort" author="jaragunde">
        <comment>Updating effort values (hours to seconds) in task_element table</comment>
        <sql>
            UPDATE task_element
            SET sum_of_assigned_effort = sum_of_assigned_effort*3600
        </sql>
    </changeSet>

</databaseChangeLog>
